<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PharmaBridge ‚Äî Multilingual Learning</title>
<style>
  :root {
    --navy: #19478C;
    --sky: #3EB3E1;
    --teal: #009CA2;
    --navy-light: #1e559e;
    --bg: #f0f6ff;
    --white: #ffffff;
    --gray-light: #e8f2fb;
    --gray: #6b8cad;
    --text: #1a2e4a;
    --success: #22c55e;
    --warning: #f59e0b;
    --danger: #ef4444;
    font-family: Tahoma, Geneva, Verdana, sans-serif;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); min-height: 100vh; font-family: Tahoma, Geneva, Verdana, sans-serif; }

  /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
  .screen { display: none; min-height: 100vh; }
  .screen.active { display: flex; flex-direction: column; }

  /* ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ */
  #screen-landing {
    background: linear-gradient(135deg, var(--navy) 0%, #1a5fa0 40%, var(--teal) 100%);
    align-items: center; justify-content: center; text-align: center; padding: 2rem;
    position: relative; overflow: hidden;
  }
  #screen-landing::before {
    content: ''; position: absolute; inset: 0;
    background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(62,179,225,0.25) 0%, transparent 70%);
  }
  .landing-card {
    background: rgba(255,255,255,0.08); backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.18); border-radius: 24px;
    padding: 3rem 2.5rem; max-width: 540px; width: 100%; position: relative; z-index: 1;
    box-shadow: 0 32px 64px rgba(0,0,0,0.25);
  }
  .logo-icon { font-size: 3rem; margin-bottom: 0.5rem; }
  .landing-card h1 { color: #fff; font-size: 2rem; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 0.4rem; }
  .landing-card .subtitle { color: rgba(255,255,255,0.75); font-size: 0.95rem; margin-bottom: 2.5rem; }
  .lang-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
  .lang-btn {
    background: rgba(255,255,255,0.12); border: 2px solid rgba(255,255,255,0.25);
    border-radius: 16px; padding: 1.4rem 0.5rem; cursor: pointer; transition: all 0.25s;
    color: #fff; text-align: center;
  }
  .lang-btn:hover { background: rgba(255,255,255,0.22); border-color: var(--sky); transform: translateY(-3px); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
  .lang-btn .flag { font-size: 2.2rem; display: block; margin-bottom: 0.5rem; }
  .lang-btn .lang-name { font-size: 1rem; font-weight: 700; display: block; }
  .lang-btn .lang-native { font-size: 0.8rem; opacity: 0.7; }
  .overall-progress-wrap { margin-top: 1rem; }
  .overall-progress-wrap p { color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-bottom: 0.5rem; }
  .overall-bar { background: rgba(255,255,255,0.15); border-radius: 99px; height: 8px; overflow: hidden; }
  .overall-bar-fill { height: 100%; background: linear-gradient(90deg, var(--sky), var(--teal)); border-radius: 99px; transition: width 0.5s; }

  /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
  #screen-main { flex-direction: row; }
  .sidebar {
    width: 260px; background: var(--navy); color: #fff; padding: 1.5rem 1rem; flex-shrink: 0;
    display: flex; flex-direction: column; min-height: 100vh; position: sticky; top: 0; height: 100vh; overflow-y: auto;
  }
  .sidebar-logo { font-size: 1.1rem; font-weight: 700; color: #fff; padding: 0.5rem 0.5rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.15); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
  .sidebar-lang-badge { background: var(--teal); border-radius: 6px; padding: 2px 8px; font-size: 0.7rem; margin-left: auto; }
  .sidebar-section-btn {
    width: 100%; text-align: left; background: transparent; border: none; color: rgba(255,255,255,0.75);
    padding: 0.65rem 0.75rem; border-radius: 10px; cursor: pointer; font-family: Tahoma, Geneva, Verdana, sans-serif;
    font-size: 0.85rem; display: flex; align-items: center; gap: 0.6rem; transition: all 0.2s; margin-bottom: 2px;
  }
  .sidebar-section-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
  .sidebar-section-btn.active { background: rgba(62,179,225,0.25); color: var(--sky); border-left: 3px solid var(--sky); padding-left: calc(0.75rem - 3px); }
  .sidebar-section-btn.completed { color: var(--teal); }
  .sidebar-section-btn .s-icon { width: 22px; text-align: center; }
  .sidebar-section-btn .s-check { margin-left: auto; font-size: 0.7rem; }
  .sidebar-bottom { margin-top: auto; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); }
  .back-lang-btn { width: 100%; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: rgba(255,255,255,0.6); border-radius: 8px; padding: 0.5rem; font-size: 0.8rem; cursor: pointer; font-family: Tahoma; transition: all 0.2s; }
  .back-lang-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }

  .main-content { flex: 1; padding: 2rem; overflow-y: auto; max-width: 860px; }
  .section-header { margin-bottom: 1.5rem; }
  .section-header h2 { font-size: 1.6rem; color: var(--navy); font-weight: 700; }
  .section-header p { color: var(--gray); font-size: 0.9rem; margin-top: 0.3rem; }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .phrase-card {
    background: #fff; border-radius: 14px; padding: 1.1rem 1.3rem;
    box-shadow: 0 2px 8px rgba(25,71,140,0.07); margin-bottom: 0.75rem;
    display: flex; align-items: center; gap: 1rem; border-left: 4px solid var(--sky);
    transition: box-shadow 0.2s;
  }
  .phrase-card:hover { box-shadow: 0 4px 16px rgba(25,71,140,0.13); }
  .phrase-text { flex: 1; }
  .phrase-english { font-weight: 700; font-size: 0.95rem; color: var(--navy); }
  .phrase-translation { font-size: 1.05rem; color: var(--teal); margin-top: 0.2rem; }
  .phrase-romanize { font-size: 0.8rem; color: var(--gray); margin-top: 0.1rem; font-style: italic; }
  .play-btn {
    background: linear-gradient(135deg, var(--sky), var(--teal)); border: none; border-radius: 50%;
    width: 40px; height: 40px; color: #fff; cursor: pointer; font-size: 1rem; display: flex;
    align-items: center; justify-content: center; flex-shrink: 0; transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 8px rgba(0,156,162,0.3);
  }
  .play-btn:hover { transform: scale(1.1); box-shadow: 0 4px 14px rgba(0,156,162,0.4); }
  .play-btn.playing { background: linear-gradient(135deg, var(--navy), var(--navy-light)); animation: pulse 0.8s infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }

  /* ‚îÄ‚îÄ NUMBERS GRID ‚îÄ‚îÄ */
  .numbers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.75rem; }
  .number-card {
    background: #fff; border-radius: 12px; padding: 1rem; text-align: center;
    box-shadow: 0 2px 8px rgba(25,71,140,0.07); cursor: pointer; transition: all 0.2s;
    border: 2px solid transparent;
  }
  .number-card:hover { border-color: var(--sky); transform: translateY(-2px); }
  .number-numeral { font-size: 2rem; font-weight: 700; color: var(--navy); }
  .number-translation { font-size: 1rem; color: var(--teal); margin-top: 0.2rem; }
  .number-romanize { font-size: 0.7rem; color: var(--gray); font-style: italic; }

  /* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
  .progress-section {
    position: sticky; bottom: 0; background: #fff; border-top: 1px solid var(--gray-light);
    padding: 0.75rem 2rem; display: flex; align-items: center; gap: 1rem; box-shadow: 0 -4px 12px rgba(0,0,0,0.06);
  }
  .progress-label { font-size: 0.8rem; color: var(--gray); white-space: nowrap; }
  .progress-bar { flex: 1; background: var(--gray-light); border-radius: 99px; height: 10px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--sky), var(--teal)); border-radius: 99px; transition: width 0.4s ease; }
  .progress-pct { font-size: 0.85rem; font-weight: 700; color: var(--teal); white-space: nowrap; }

  /* ‚îÄ‚îÄ SUB-SECTIONS (Conditions) ‚îÄ‚îÄ */
  .subsection { margin-bottom: 1.5rem; }
  .subsection-title {
    font-size: 1rem; font-weight: 700; color: var(--navy); padding: 0.6rem 1rem;
    background: var(--gray-light); border-radius: 8px; margin-bottom: 0.6rem; display: flex; align-items: center; gap: 0.5rem;
    cursor: pointer; user-select: none;
  }
  .subsection-title .toggle { margin-left: auto; color: var(--gray); transition: transform 0.2s; }
  .subsection-title.open .toggle { transform: rotate(180deg); }
  .subsection-body { display: none; }
  .subsection-body.open { display: block; }

  /* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
  .quiz-wrap { max-width: 600px; }
  .quiz-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
  .quiz-question-counter { font-size: 0.85rem; color: var(--gray); }
  .quiz-score-display { font-size: 0.85rem; font-weight: 700; color: var(--teal); }
  .quiz-card { background: #fff; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 16px rgba(25,71,140,0.1); }
  .quiz-type-badge { display: inline-block; background: var(--gray-light); color: var(--navy); font-size: 0.7rem; font-weight: 700; border-radius: 6px; padding: 2px 8px; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.5px; }
  .quiz-question { font-size: 1.1rem; font-weight: 700; color: var(--navy); margin-bottom: 1.5rem; line-height: 1.4; }
  .quiz-audio-btn {
    display: flex; align-items: center; gap: 0.75rem; background: linear-gradient(135deg, var(--navy), var(--navy-light));
    color: #fff; border: none; border-radius: 12px; padding: 0.85rem 1.5rem; cursor: pointer; font-family: Tahoma; font-size: 0.95rem;
    margin-bottom: 1.5rem; transition: all 0.2s;
  }
  .quiz-audio-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(25,71,140,0.3); }
  .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
  .option-btn {
    background: var(--gray-light); border: 2px solid transparent; border-radius: 12px; padding: 0.85rem 1rem;
    cursor: pointer; font-family: Tahoma; font-size: 0.9rem; color: var(--navy); text-align: left; transition: all 0.2s;
  }
  .option-btn:hover:not([disabled]) { border-color: var(--sky); background: #e0f4fb; }
  .option-btn.correct { background: #d1fae5; border-color: var(--success); color: #166534; }
  .option-btn.wrong { background: #fee2e2; border-color: var(--danger); color: #991b1b; }
  .option-btn[disabled] { cursor: default; }
  .quiz-feedback { margin-top: 1.2rem; padding: 0.85rem 1rem; border-radius: 10px; font-size: 0.9rem; font-weight: 600; display: none; }
  .quiz-feedback.correct { background: #d1fae5; color: #166534; display: block; }
  .quiz-feedback.wrong { background: #fee2e2; color: #991b1b; display: block; }
  .quiz-next-btn {
    margin-top: 1.2rem; width: 100%; background: linear-gradient(135deg, var(--sky), var(--teal)); color: #fff;
    border: none; border-radius: 12px; padding: 0.9rem; font-family: Tahoma; font-size: 1rem; font-weight: 700;
    cursor: pointer; display: none; transition: all 0.2s;
  }
  .quiz-next-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(0,156,162,0.35); }
  .quiz-results { text-align: center; padding: 2rem; background: #fff; border-radius: 16px; box-shadow: 0 4px 16px rgba(25,71,140,0.1); }
  .quiz-results .big-score { font-size: 4rem; font-weight: 700; color: var(--teal); }
  .quiz-results p { color: var(--gray); margin: 0.5rem 0 1.5rem; }
  .quiz-results .result-msg { font-size: 1.1rem; color: var(--navy); font-weight: 700; margin-bottom: 0.5rem; }
  .btn-primary {
    background: linear-gradient(135deg, var(--sky), var(--teal)); color: #fff; border: none;
    border-radius: 12px; padding: 0.85rem 1.8rem; font-family: Tahoma; font-size: 0.95rem; font-weight: 700;
    cursor: pointer; transition: all 0.2s;
  }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(0,156,162,0.35); }
  .btn-secondary {
    background: transparent; color: var(--navy); border: 2px solid var(--navy);
    border-radius: 12px; padding: 0.75rem 1.5rem; font-family: Tahoma; font-size: 0.9rem; font-weight: 700;
    cursor: pointer; transition: all 0.2s; margin-right: 0.75rem;
  }
  .btn-secondary:hover { background: var(--navy); color: #fff; }

  .section-nav { display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--gray-light); }
  .start-quiz-btn {
    width: 100%; background: linear-gradient(135deg, var(--navy), var(--navy-light)); color: #fff; border: none;
    border-radius: 14px; padding: 1rem; font-family: Tahoma; font-size: 1rem; font-weight: 700;
    cursor: pointer; transition: all 0.2s; margin-top: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;
  }
  .start-quiz-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(25,71,140,0.3); }

  /* Mobile */
  .mobile-menu-btn { display: none; }
  @media(max-width:768px){
    #screen-main { flex-direction: column; }
    .sidebar { width: 100%; min-height: auto; height: auto; position: relative; padding: 1rem; }
    .sidebar-sections { display: none; }
    .sidebar-sections.open { display: block; }
    .mobile-menu-btn { display: block; background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 0.4rem 0.8rem; border-radius: 6px; cursor: pointer; font-family: Tahoma; }
    .main-content { padding: 1rem; }
    .options-grid { grid-template-columns: 1fr; }
    .lang-grid { grid-template-columns: 1fr 1fr; }
  }

  .tag-new { background: var(--teal); color: #fff; font-size: 0.65rem; border-radius: 4px; padding: 1px 5px; vertical-align: middle; margin-left: 4px; }
</style>
</head>
<body>

<!-- LANDING SCREEN -->
<div id="screen-landing" class="screen active">
  <div class="landing-card">
    <div class="logo-icon">üíä</div>
    <h1>PharmaBridge</h1>
    <p class="subtitle">Multilingual learning for pharmacy staff ‚Äî speak with every patient</p>
    <div class="lang-grid">
      <button class="lang-btn" onclick="selectLanguage('mandarin')">
        <span class="flag">üá®üá≥</span>
        <span class="lang-name">Mandarin</span>
        <span class="lang-native">ÊôÆÈÄöËØù</span>
      </button>
      <button class="lang-btn" onclick="selectLanguage('malay')">
        <span class="flag">üá≤üáæ</span>
        <span class="lang-name">Malay</span>
        <span class="lang-native">Bahasa Melayu</span>
      </button>

    </div>
    <div class="overall-progress-wrap">
      <p>Your overall progress</p>
      <div class="overall-bar"><div class="overall-bar-fill" id="overall-bar-fill" style="width:0%"></div></div>
    </div>
  </div>
</div>

<!-- MAIN SCREEN -->
<div id="screen-main" class="screen">
  <aside class="sidebar">
    <div class="sidebar-logo">
      üíä PharmaBridge
      <span class="sidebar-lang-badge" id="sidebar-lang-badge">EN</span>
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
    </div>
    <nav class="sidebar-sections" id="sidebar-sections">
      <button class="sidebar-section-btn" onclick="showSection('greetings')" id="nav-greetings">
        <span class="s-icon">üëã</span> Greetings <span class="s-check" id="check-greetings"></span>
      </button>
      <button class="sidebar-section-btn" onclick="showSection('numbers')" id="nav-numbers">
        <span class="s-icon">üî¢</span> Numbers <span class="s-check" id="check-numbers"></span>
      </button>
      <button class="sidebar-section-btn" onclick="showSection('frequency')" id="nav-frequency">
        <span class="s-icon">‚è∞</span> Frequency & Duration <span class="s-check" id="check-frequency"></span>
      </button>
      <button class="sidebar-section-btn" onclick="showSection('dispensing')" id="nav-dispensing">
        <span class="s-icon">üí¨</span> Dispensing Phrases <span class="s-check" id="check-dispensing"></span>
      </button>
      <button class="sidebar-section-btn" onclick="showSection('conditions')" id="nav-conditions">
        <span class="s-icon">üè•</span> Conditions <span class="s-check" id="check-conditions"></span>
      </button>
    </nav>
    <div class="sidebar-bottom">
      <button class="back-lang-btn" onclick="goHome()">‚Üê Change Language</button>
    </div>
  </aside>

  <div style="flex:1;display:flex;flex-direction:column;overflow:hidden;">
    <div class="main-content" id="main-content">
      <!-- Dynamic content here -->
    </div>
    <div class="progress-section" id="progress-section">
      <span class="progress-label" id="progress-label">Progress</span>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
      <span class="progress-pct" id="progress-pct">0%</span>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const LANG_LABELS = { mandarin: 'ÊôÆÈÄöËØù', malay: 'Melayu' };

const DATA = {
  mandarin: {
    greetings: [
      { en: 'Good morning', tr: 'Êó©‰∏äÂ•Ω', rom: 'Z«éoshang h«éo' },
      { en: 'Good afternoon', tr: '‰∏ãÂçàÂ•Ω', rom: 'Xi√†w«î h«éo' },
      { en: 'Good evening', tr: 'Êôö‰∏äÂ•Ω', rom: 'W«énshang h«éo' },
      { en: 'Hi, what can I help you with?', tr: '‰Ω†Â•ΩÔºåÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏Æ‰Ω†Ôºü', rom: 'N«ê h«éo, y«íu sh√©nme kƒõy«ê bƒÅng n«ê?' },
      { en: 'May I have your name & NRIC number?', tr: 'ËØ∑ÈóÆÊÇ®ÁöÑÂßìÂêçÂíåË∫´‰ªΩËØÅÂè∑Á†ÅÔºü', rom: 'Q«êngw√®n n√≠n de x√¨ngm√≠ng h√© shƒìnf√®n zh√®ng h√†om«é?' },
      { en: 'Do you have any allergies?', tr: 'ÊÇ®Êúâ‰ªª‰ΩïËøáÊïèÂêóÔºü', rom: 'N√≠n y«íu r√®nh√© gu√≤m«ên ma?' },
      { en: 'Please take a seat and wait for your queue number.', tr: 'ËØ∑ÂÖàÂùê‰∏ãÊù•ÔºåÁ≠âÂÄôÂè´Âè∑„ÄÇ', rom: 'Q«êng xiƒÅn zu√≤xia l√°i, dƒõngh√≤u ji√†o h√†o.' },
      { en: 'Thank you.', tr: 'Ë∞¢Ë∞¢„ÄÇ', rom: 'Xi√®xi√®.' },
    ],
    numbers: [
      { en: '1', tr: '‰∏Ä', rom: 'Yƒ´' }, { en: '2', tr: '‰∫å', rom: '√àr' }, { en: '3', tr: '‰∏â', rom: 'SƒÅn' },
      { en: '4', tr: 'Âõõ', rom: 'S√¨' }, { en: '5', tr: '‰∫î', rom: 'W«î' }, { en: '6', tr: 'ÂÖ≠', rom: 'Li√π' },
      { en: '7', tr: '‰∏É', rom: 'Qƒ´' }, { en: '8', tr: 'ÂÖ´', rom: 'BƒÅ' }, { en: '9', tr: '‰πù', rom: 'Ji«î' },
      { en: '10', tr: 'ÂçÅ', rom: 'Sh√≠' }, { en: '11', tr: 'ÂçÅ‰∏Ä', rom: 'Sh√≠yƒ´' }, { en: '12', tr: 'ÂçÅ‰∫å', rom: 'Sh√≠\'√®r' },
      { en: '13', tr: 'ÂçÅ‰∏â', rom: 'Sh√≠sƒÅn' }, { en: '14', tr: 'ÂçÅÂõõ', rom: 'Sh√≠s√¨' }, { en: '15', tr: 'ÂçÅ‰∫î', rom: 'Sh√≠w«î' },
      { en: '16', tr: 'ÂçÅÂÖ≠', rom: 'Sh√≠li√π' }, { en: '17', tr: 'ÂçÅ‰∏É', rom: 'Sh√≠qƒ´' }, { en: '18', tr: 'ÂçÅÂÖ´', rom: 'Sh√≠bƒÅ' },
      { en: '19', tr: 'ÂçÅ‰πù', rom: 'Sh√≠ji«î' }, { en: '20', tr: '‰∫åÂçÅ', rom: '√àrsh√≠' },
    ],
    frequency: [
      { en: 'Morning', tr: 'Êó©‰∏ä', rom: 'Z«éoshang' },
      { en: 'Afternoon', tr: '‰∏ãÂçà', rom: 'Xi√†w«î' },
      { en: 'Evening', tr: 'ÂÇçÊôö', rom: 'B√†ngw«én' },
      { en: 'Night', tr: 'Êôö‰∏ä', rom: 'W«énshang' },
      { en: 'Day', tr: 'Â§©', rom: 'TiƒÅn' },
      { en: 'Hour', tr: 'Â∞èÊó∂', rom: 'Xi«éosh√≠' },
      { en: 'Week', tr: 'ÊòüÊúü', rom: 'Xƒ´ngqƒ´' },
      { en: 'Month', tr: 'Êúà', rom: 'Yu√®' },
      { en: 'Year', tr: 'Âπ¥', rom: 'Ni√°n' },
      { en: 'Half', tr: 'Âçä', rom: 'B√†n' },
      { en: 'Alternate day', tr: 'ÈöîÂ§©', rom: 'G√© tiƒÅn' },
      { en: 'Before food', tr: 'È•≠Ââç', rom: 'F√†n qi√°n' },
      { en: 'After food', tr: 'È•≠Âêé', rom: 'F√†n h√≤u' },
    ],
    dispensing: [
      { en: 'Take one tablet two times a day.', tr: 'ÊØèÂ§©ÊúçÁî®‰∏§Ê¨°ÔºåÊØèÊ¨°‰∏ÄÁâá„ÄÇ', rom: 'MƒõitiƒÅn f√∫y√≤ng li«éng c√¨, mƒõi c√¨ yƒ´ pi√†n.' },
      { en: 'With food', tr: 'ÈöèÈ§êÊúçÁî®', rom: 'Su√≠ cƒÅn f√∫y√≤ng' },
      { en: 'Without food', tr: '‰∏çÈúÄÈöèÈ§êÊúçÁî®', rom: 'B√π x≈´ su√≠ cƒÅn f√∫y√≤ng' },
      { en: 'Take this on an empty stomach.', tr: 'ËØ∑Âú®Á©∫ËÖπÊó∂ÊúçÁî®„ÄÇ', rom: 'Q«êng z√†i k≈çngf√π sh√≠ f√∫y√≤ng.' },
      { en: 'Complete the full course even if you feel better.', tr: 'Âç≥‰ΩøÊÑüËßâÂ•ΩËΩ¨Ôºå‰πüËØ∑ÊåâÁñóÁ®ãÊúçÂÆåËçØÁâ©„ÄÇ', rom: 'J√≠sh«ê g«énju√© h«éo zhu«én, yƒõ q«êng √†n li√°och√©ng f√∫ w√°n y√†ow√π.' },
      { en: 'Take with plenty of water.', tr: 'ËØ∑Â§öÂñùÊ∞¥ÊúçÁî®„ÄÇ', rom: 'Q«êng du≈ç hƒì shu«ê f√∫y√≤ng.' },
      { en: 'Store in a cool, dry place.', tr: 'ËØ∑Â≠òÊîæÂú®Èò¥ÂáâÂπ≤Áá•Â§Ñ„ÄÇ', rom: 'Q«êng c√∫nf√†ng z√†i yƒ´nli√°ng gƒÅnz√†o ch√π.' },
      { en: 'Avoid alcohol.', tr: 'ÈÅøÂÖçÈ•ÆÈÖí„ÄÇ', rom: 'B√¨mi«én y«ênji«î.' },
      { en: 'This may cause drowsiness.', tr: 'Ê≠§ËçØÂèØËÉΩÂºïËµ∑ÂóúÁù°„ÄÇ', rom: 'C«ê y√†o kƒõn√©ng y«ênq«ê sh√¨shu√¨.' },
      { en: 'Avoid driving or operating machinery.', tr: 'ÈÅøÂÖçÈ©æÈ©∂ÊàñÊìç‰ΩúÊú∫Ê¢∞„ÄÇ', rom: 'B√¨mi«én ji√†sh«ê hu√≤ cƒÅozu√≤ jƒ´xi√®.' },
      { en: 'This medication needs to be stored in the fridge.', tr: 'Ê≠§ËçØÁâ©ÈúÄË¶ÅÂÜ∑Ëóè„ÄÇ', rom: 'C«ê y√†ow√π x≈´y√†o lƒõngc√°ng.' },
      { en: "If you forget a dose, take it as soon as you remember unless it's nearly time for the next one.", tr: 'Â¶ÇÊûúÂøòËÆ∞ÊúçËçØÔºåËØ∑Â∞ΩÂø´ÊúçÁî®Ôºå‰ΩÜÂ¶ÇÊûúÊé•Ëøë‰∏ãÊ¨°ÊúçËçØÊó∂Èó¥ÔºåÂàôË∑≥Ëøá„ÄÇ', rom: 'R√∫gu«í w√†ngj√¨ f√∫y√†o, q«êng j«ênku√†i f√∫y√≤ng, d√†n r√∫gu«í jiƒìj√¨n xi√† c√¨ f√∫y√†o sh√≠jiƒÅn, z√© ti√†ogu√≤.' },
      { en: 'Take one tablet one time a day at the same time everyday.', tr: 'ÊØèÂ§©Âêå‰∏ÄÊó∂Èó¥ÊúçÁî®‰∏ÄÊ¨°ÔºåÊØèÊ¨°‰∏ÄÁâá„ÄÇ', rom: 'MƒõitiƒÅn t√≥ngyƒ´ sh√≠jiƒÅn f√∫y√≤ng yƒ´ c√¨, mƒõi c√¨ yƒ´ pi√†n.' },
    ],
    conditions: {
      'A': [
        { en: 'Acne', tr: 'Áó§ÁñÆ', rom: 'Cu√≥chuƒÅng' },
        { en: 'Allergic rhinitis', tr: 'ËøáÊïèÊÄßÈºªÁÇé', rom: 'Gu√≤m«ên x√¨ng b√≠y√°n' },
        { en: 'Allergy', tr: 'ËøáÊïè', rom: 'Gu√≤m«ên' },
        { en: 'Arthritis', tr: 'ÂÖ≥ËäÇÁÇé', rom: 'GuƒÅnji√© y√°n' },
        { en: 'Asthma', tr: 'ÂìÆÂñò', rom: 'XiƒÅochu«én' },
      ],
      'B': [
        { en: 'Back pain', tr: 'ËÉåÁóõ', rom: 'B√®i t√≤ng' },
        { en: 'Blood pressure (high)', tr: 'È´òË°ÄÂéã', rom: 'GƒÅo xu√®yƒÅ' },
        { en: 'Blood pressure (low)', tr: '‰ΩéË°ÄÂéã', rom: 'Dƒ´ xu√®yƒÅ' },
      ],
      'C': [
        { en: 'Chest pain', tr: 'ËÉ∏Áóõ', rom: 'Xi≈çng t√≤ng' },
        { en: 'Cholesterol (high)', tr: 'È´òËÉÜÂõ∫ÈÜá', rom: 'GƒÅo d«éng√πch√∫n' },
        { en: 'Cold / Flu', tr: 'ÊÑüÂÜí', rom: 'G«énm√†o' },
        { en: 'Constipation', tr: '‰æøÁßò', rom: 'Bi√†nm√¨' },
        { en: 'Cough', tr: 'Âí≥ÂóΩ', rom: 'K√©s√≤u' },
      ],
      'D': [
        { en: 'Diarrhoea', tr: 'ËÖπÊ≥ª', rom: 'F√πxi√®' },
        { en: 'Diabetes', tr: 'Á≥ñÂ∞øÁóÖ', rom: 'T√°ngni√†o b√¨ng' },
        { en: 'Dizziness', tr: 'Â§¥Êôï', rom: 'T√≥uy≈´n' },
      ],
      'E': [
        { en: 'Eczema', tr: 'ÊπøÁñπ', rom: 'Shƒ´zhƒõn' },
        { en: 'Eye infection', tr: 'ÁúºÈÉ®ÊÑüÊüì', rom: 'Y«én b√π g«énr«én' },
      ],
      'F': [
        { en: 'Fever', tr: 'ÂèëÁÉß', rom: 'FƒÅshƒÅo' },
        { en: 'Fungal infection', tr: 'ÁúüËèåÊÑüÊüì', rom: 'Zhƒìnj≈´n g«énr«én' },
      ],
      'G': [
        { en: 'Gastric pain / Stomach ache', tr: 'ËÉÉÁóõ', rom: 'W√®i t√≤ng' },
        { en: 'Gout', tr: 'ÁóõÈ£é', rom: 'T√≤ngfƒìng' },
      ],
      'H': [
        { en: 'Headache', tr: 'Â§¥Áóõ', rom: 'T√≥ut√≤ng' },
        { en: 'Heart disease', tr: 'ÂøÉËÑèÁóÖ', rom: 'Xƒ´nz√†ng b√¨ng' },
      ],
      'I': [
        { en: 'Indigestion', tr: 'Ê∂àÂåñ‰∏çËâØ', rom: 'XiƒÅohu√† b√πli√°ng' },
        { en: 'Insomnia', tr: 'Â§±Áú†', rom: 'Shƒ´mi√°n' },
        { en: 'Itch / Rash', tr: 'ÁöÆÁñπ/ÁòôÁóí', rom: 'P√≠zhƒõn / S√†o y«éng' },
      ],
      'J': [
        { en: 'Joint pain', tr: 'ÂÖ≥ËäÇÁóõ', rom: 'GuƒÅnji√© t√≤ng' },
      ],
      'K': [
        { en: 'Kidney disease', tr: 'ËÇæËÑèÁóÖ', rom: 'Sh√®nz√†ng b√¨ng' },
      ],
      'M': [
        { en: 'Migraine', tr: 'ÂÅèÂ§¥Áóõ', rom: 'PiƒÅn t√≥ut√≤ng' },
        { en: 'Muscle pain', tr: 'ËÇåËÇâÈÖ∏Áóõ', rom: 'Jƒ´r√≤u suƒÅnt√≤ng' },
      ],
      'N': [
        { en: 'Nausea / Vomiting', tr: 'ÊÅ∂ÂøÉ/ÂëïÂêê', rom: 'ƒöxƒ´n / «ëut√π' },
      ],
      'P': [
        { en: 'Pain', tr: 'ÁñºÁóõ', rom: 'T√©ngt√≤ng' },
        { en: 'Psoriasis', tr: 'ÁâõÁöÆÁô£', rom: 'Ni√∫p√≠ xu«én' },
      ],
      'S': [
        { en: 'Sore throat', tr: 'ÂñâÂíôÁóõ', rom: 'H√≥ul√≥ng t√≤ng' },
        { en: 'Skin infection', tr: 'ÁöÆËÇ§ÊÑüÊüì', rom: 'P√≠f≈´ g«énr«én' },
        { en: 'Sinusitis', tr: 'ÈºªÁ™¶ÁÇé', rom: 'B√≠ d√≤u y√°n' },
      ],
      'T': [
        { en: 'Thyroid disorder', tr: 'Áî≤Áä∂ËÖ∫ÁñæÁóÖ', rom: 'Ji«ézhu√†ngxi√†n j√≠b√¨ng' },
        { en: 'Toothache', tr: 'ÁâôÁóõ', rom: 'Y√°t√≤ng' },
      ],
      'U': [
        { en: 'Urinary tract infection (UTI)', tr: 'Â∞øË∑ØÊÑüÊüì', rom: 'Ni√†o l√π g«énr«én' },
      ],
      'W': [
        { en: 'Wound / Cut', tr: '‰º§Âè£', rom: 'ShƒÅngk«íu' },
      ],
    }
  },
  malay: {
    greetings: [
      { en: 'Good morning', tr: 'Selamat pagi', rom: '' },
      { en: 'Good afternoon', tr: 'Selamat tengah hari', rom: '' },
      { en: 'Good evening', tr: 'Selamat petang', rom: '' },
      { en: 'Hi, what can I help you with?', tr: 'Hai, ada yang boleh saya bantu?', rom: '' },
      { en: 'May I have your name & NRIC number?', tr: 'Boleh saya dapatkan nama dan nombor NRIC anda?', rom: '' },
      { en: 'Do you have any allergies?', tr: 'Adakah anda mempunyai sebarang alahan?', rom: '' },
      { en: 'Please take a seat and wait for your queue number.', tr: 'Sila duduk dan tunggu nombor giliran anda.', rom: '' },
      { en: 'Thank you.', tr: 'Terima kasih.', rom: '' },
    ],
    numbers: [
      { en: '1', tr: 'Satu', rom: '' }, { en: '2', tr: 'Dua', rom: '' }, { en: '3', tr: 'Tiga', rom: '' },
      { en: '4', tr: 'Empat', rom: '' }, { en: '5', tr: 'Lima', rom: '' }, { en: '6', tr: 'Enam', rom: '' },
      { en: '7', tr: 'Tujuh', rom: '' }, { en: '8', tr: 'Lapan', rom: '' }, { en: '9', tr: 'Sembilan', rom: '' },
      { en: '10', tr: 'Sepuluh', rom: '' }, { en: '11', tr: 'Sebelas', rom: '' }, { en: '12', tr: 'Dua belas', rom: '' },
      { en: '13', tr: 'Tiga belas', rom: '' }, { en: '14', tr: 'Empat belas', rom: '' }, { en: '15', tr: 'Lima belas', rom: '' },
      { en: '16', tr: 'Enam belas', rom: '' }, { en: '17', tr: 'Tujuh belas', rom: '' }, { en: '18', tr: 'Lapan belas', rom: '' },
      { en: '19', tr: 'Sembilan belas', rom: '' }, { en: '20', tr: 'Dua puluh', rom: '' },
    ],
    frequency: [
      { en: 'Morning', tr: 'Pagi', rom: '' },
      { en: 'Afternoon', tr: 'Tengah hari', rom: '' },
      { en: 'Evening', tr: 'Petang', rom: '' },
      { en: 'Night', tr: 'Malam', rom: '' },
      { en: 'Day', tr: 'Hari', rom: '' },
      { en: 'Hour', tr: 'Jam', rom: '' },
      { en: 'Week', tr: 'Minggu', rom: '' },
      { en: 'Month', tr: 'Bulan', rom: '' },
      { en: 'Year', tr: 'Tahun', rom: '' },
      { en: 'Half', tr: 'Separuh', rom: '' },
      { en: 'Alternate day', tr: 'Selang sehari', rom: '' },
      { en: 'Before food', tr: 'Sebelum makan', rom: '' },
      { en: 'After food', tr: 'Selepas makan', rom: '' },
    ],
    dispensing: [
      { en: 'Take one tablet two times a day.', tr: 'Ambil satu tablet dua kali sehari.', rom: '' },
      { en: 'With food', tr: 'Bersama makanan', rom: '' },
      { en: 'Without food', tr: 'Tanpa makanan', rom: '' },
      { en: 'Take this on an empty stomach.', tr: 'Ambil ini ketika perut kosong.', rom: '' },
      { en: 'Complete the full course even if you feel better.', tr: 'Habiskan kursus penuh walaupun anda rasa lebih baik.', rom: '' },
      { en: 'Take with plenty of water.', tr: 'Ambil dengan banyak air.', rom: '' },
      { en: 'Store in a cool, dry place.', tr: 'Simpan di tempat yang sejuk dan kering.', rom: '' },
      { en: 'Avoid alcohol.', tr: 'Elakkan alkohol.', rom: '' },
      { en: 'This may cause drowsiness.', tr: 'Ini mungkin menyebabkan mengantuk.', rom: '' },
      { en: 'Avoid driving or operating machinery.', tr: 'Elakkan memandu atau mengendalikan jentera.', rom: '' },
      { en: 'This medication needs to be stored in the fridge.', tr: 'Ubat ini perlu disimpan di dalam peti sejuk.', rom: '' },
      { en: "If you forget a dose, take it as soon as you remember unless it's nearly time for the next one.", tr: 'Jika anda terlupa dos, ambillah sebaik sahaja anda ingat melainkan sudah hampir masa untuk dos berikutnya.', rom: '' },
      { en: 'Take one tablet one time a day at the same time everyday.', tr: 'Ambil satu tablet sekali sehari pada waktu yang sama setiap hari.', rom: '' },
    ],
    conditions: {
      'A': [
        { en: 'Acne', tr: 'Jerawat', rom: '' },
        { en: 'Allergic rhinitis', tr: 'Rhinitis alergik', rom: '' },
        { en: 'Allergy', tr: 'Alahan', rom: '' },
        { en: 'Arthritis', tr: 'Radang sendi', rom: '' },
        { en: 'Asthma', tr: 'Asma', rom: '' },
      ],
      'B': [
        { en: 'Back pain', tr: 'Sakit belakang', rom: '' },
        { en: 'Blood pressure (high)', tr: 'Tekanan darah tinggi', rom: '' },
        { en: 'Blood pressure (low)', tr: 'Tekanan darah rendah', rom: '' },
      ],
      'C': [
        { en: 'Chest pain', tr: 'Sakit dada', rom: '' },
        { en: 'Cholesterol (high)', tr: 'Kolesterol tinggi', rom: '' },
        { en: 'Cold / Flu', tr: 'Selesema / Flu', rom: '' },
        { en: 'Constipation', tr: 'Sembelit', rom: '' },
        { en: 'Cough', tr: 'Batuk', rom: '' },
      ],
      'D': [
        { en: 'Diarrhoea', tr: 'Cirit-birit', rom: '' },
        { en: 'Diabetes', tr: 'Kencing manis', rom: '' },
        { en: 'Dizziness', tr: 'Pening', rom: '' },
      ],
      'E': [
        { en: 'Eczema', tr: 'Ekzema', rom: '' },
        { en: 'Eye infection', tr: 'Jangkitan mata', rom: '' },
      ],
      'F': [
        { en: 'Fever', tr: 'Demam', rom: '' },
        { en: 'Fungal infection', tr: 'Jangkitan kulat', rom: '' },
      ],
      'G': [
        { en: 'Gastric pain / Stomach ache', tr: 'Sakit gastrik / Sakit perut', rom: '' },
        { en: 'Gout', tr: 'Gout', rom: '' },
      ],
      'H': [
        { en: 'Headache', tr: 'Sakit kepala', rom: '' },
        { en: 'Heart disease', tr: 'Penyakit jantung', rom: '' },
      ],
      'I': [
        { en: 'Indigestion', tr: 'Masalah penghadaman', rom: '' },
        { en: 'Insomnia', tr: 'Insomnia', rom: '' },
        { en: 'Itch / Rash', tr: 'Gatal / Ruam', rom: '' },
      ],
      'J': [
        { en: 'Joint pain', tr: 'Sakit sendi', rom: '' },
      ],
      'K': [
        { en: 'Kidney disease', tr: 'Penyakit buah pinggang', rom: '' },
      ],
      'M': [
        { en: 'Migraine', tr: 'Migrain', rom: '' },
        { en: 'Muscle pain', tr: 'Sakit otot', rom: '' },
      ],
      'N': [
        { en: 'Nausea / Vomiting', tr: 'Loya / Muntah', rom: '' },
      ],
      'P': [
        { en: 'Pain', tr: 'Kesakitan', rom: '' },
        { en: 'Psoriasis', tr: 'Psoriasis', rom: '' },
      ],
      'S': [
        { en: 'Sore throat', tr: 'Sakit tekak', rom: '' },
        { en: 'Skin infection', tr: 'Jangkitan kulit', rom: '' },
        { en: 'Sinusitis', tr: 'Sinusitis', rom: '' },
      ],
      'T': [
        { en: 'Thyroid disorder', tr: 'Gangguan tiroid', rom: '' },
        { en: 'Toothache', tr: 'Sakit gigi', rom: '' },
      ],
      'U': [
        { en: 'Urinary tract infection (UTI)', tr: 'Jangkitan saluran kencing', rom: '' },
      ],
      'W': [
        { en: 'Wound / Cut', tr: 'Luka', rom: '' },
      ],
    }
  },
};


// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentLang = null;
let currentSection = null;
let progress = {}; // { lang: { section: { seen: Set, quizDone: bool, quizScore: int } } }
let quizState = {};
let currentSpeech = null;

// Load saved progress
try { progress = JSON.parse(localStorage.getItem('pharma_progress') || '{}'); } catch(e) {}

function saveProgress() {
  const toSave = {};
  for (const [l, sections] of Object.entries(progress)) {
    toSave[l] = {};
    for (const [s, v] of Object.entries(sections)) {
      toSave[l][s] = {
        seen: [...(v.seen || [])],
        quizDone: v.quizDone || false,
        quizScore: v.quizScore || 0
      };
    }
  }
  localStorage.setItem('pharma_progress', JSON.stringify(toSave));
}

function loadProgress() {
  const saved = JSON.parse(localStorage.getItem('pharma_progress') || '{}');
  for (const [l, sections] of Object.entries(saved)) {
    progress[l] = {};
    for (const [s, v] of Object.entries(sections)) {
      progress[l][s] = {
        seen: new Set(v.seen || []),
        quizDone: v.quizDone || false,
        quizScore: v.quizScore || 0
      };
    }
  }
}
loadProgress();

function getOrInitSection(lang, section) {
  if (!progress[lang]) progress[lang] = {};
  if (!progress[lang][section]) progress[lang][section] = { seen: new Set(), quizDone: false, quizScore: 0 };
  return progress[lang][section];
}

// ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectLanguage(lang) {
  currentLang = lang;
  document.getElementById('sidebar-lang-badge').textContent = LANG_LABELS[lang];
  switchScreen('main');
  showSection('greetings');
  updateOverallProgress();
}

function goHome() {
  switchScreen('landing');
  updateLandingProgress();
}

function switchScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
}

function toggleMobileMenu() {
  const s = document.getElementById('sidebar-sections');
  s.classList.toggle('open');
}

// ‚îÄ‚îÄ‚îÄ SECTION RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SECTIONS = ['greetings','numbers','frequency','dispensing','conditions'];

function showSection(section) {
  currentSection = section;
  document.querySelectorAll('.sidebar-section-btn').forEach(b => b.classList.remove('active'));
  const btn = document.getElementById('nav-' + section);
  if (btn) btn.classList.add('active');

  const content = document.getElementById('main-content');
  const sectionData = DATA[currentLang];

  if (section === 'greetings') renderPhrases(content, 'Greetings', 'üëã', sectionData.greetings, section);
  else if (section === 'numbers') renderNumbers(content, sectionData.numbers);
  else if (section === 'frequency') renderPhrases(content, 'Frequency & Duration', '‚è∞', sectionData.frequency, section);
  else if (section === 'dispensing') renderPhrases(content, 'Dispensing Phrases', 'üí¨', sectionData.dispensing, section);
  else if (section === 'conditions') renderConditions(content, sectionData.conditions);

  updateSectionProgress(section);
  updateSidebarChecks();
}

function renderPhrases(container, title, icon, phrases, sectionKey) {
  const state = getOrInitSection(currentLang, sectionKey);
  let html = `<div class="section-header"><h2>${icon} ${title}</h2><p>${phrases.length} phrases ‚Äî click ‚ñ∂ to listen</p></div>`;
  phrases.forEach((p, i) => {
    html += `<div class="phrase-card" id="phrase-${i}" onclick="markSeen('${sectionKey}',${i},${phrases.length})">
      <div class="phrase-text">
        <div class="phrase-english">${p.en}</div>
        <div class="phrase-translation">${p.tr}</div>
        ${p.rom ? `<div class="phrase-romanize">${p.rom}</div>` : ''}
      </div>
      <button class="play-btn" id="play-${i}" onclick="event.stopPropagation();speak('${escapeSpeech(p.tr)}','${sectionKey}',${i},${phrases.length})">‚ñ∂</button>
    </div>`;
  });
  const st = getOrInitSection(currentLang, sectionKey);
  if (!st.quizDone) {
    html += `<button class="start-quiz-btn" onclick="startQuiz('${sectionKey}')">üéØ Take Quiz for this Section</button>`;
  } else {
    html += `<div style="background:#d1fae5;border-radius:12px;padding:1rem;text-align:center;margin-top:1rem;color:#166534;font-weight:700;">‚úÖ Quiz completed ‚Äî Score: ${st.quizScore}/10 <button class="btn-primary" style="margin-left:1rem;padding:0.5rem 1rem;font-size:0.85rem;" onclick="startQuiz('${sectionKey}')">Retake</button></div>`;
  }
  container.innerHTML = html;
}

function renderNumbers(container, numbers) {
  const state = getOrInitSection(currentLang, 'numbers');
  let html = `<div class="section-header"><h2>üî¢ Numbers 1‚Äì20</h2><p>Click a card to listen</p></div>
  <div class="numbers-grid">`;
  numbers.forEach((n, i) => {
    html += `<div class="number-card" onclick="speak('${escapeSpeech(n.tr)}','numbers',${i},${numbers.length})">
      <div class="number-numeral">${n.en}</div>
      <div class="number-translation">${n.tr}</div>
      ${n.rom ? `<div class="number-romanize">${n.rom}</div>` : ''}
    </div>`;
  });
  html += '</div>';
  const st = getOrInitSection(currentLang, 'numbers');
  if (!st.quizDone) {
    html += `<button class="start-quiz-btn" onclick="startQuiz('numbers')">üéØ Take Quiz for this Section</button>`;
  } else {
    html += `<div style="background:#d1fae5;border-radius:12px;padding:1rem;text-align:center;margin-top:1rem;color:#166534;font-weight:700;">‚úÖ Quiz completed ‚Äî Score: ${st.quizScore}/10 <button class="btn-primary" style="margin-left:1rem;padding:0.5rem 1rem;font-size:0.85rem;" onclick="startQuiz('numbers')">Retake</button></div>`;
  }
  container.innerHTML = html;
}

function renderConditions(container, conditions) {
  let html = `<div class="section-header"><h2>üè• Conditions</h2><p>Common medical conditions ‚Äî click a letter to expand</p></div>`;
  const letters = Object.keys(conditions).sort();
  letters.forEach(letter => {
    const items = conditions[letter];
    html += `<div class="subsection">
      <div class="subsection-title" onclick="toggleSub(this)">
        <strong>${letter}</strong>
        <span style="color:var(--gray);font-weight:400;font-size:0.85rem;">${items.length} condition${items.length>1?'s':''}</span>
        <span class="toggle">‚ñº</span>
      </div>
      <div class="subsection-body">`;
    items.forEach((item, i) => {
      html += `<div class="phrase-card" onclick="markSeenCond('${letter}',${i},conditions)">
        <div class="phrase-text">
          <div class="phrase-english">${item.en}</div>
          <div class="phrase-translation">${item.tr}</div>
          ${item.rom ? `<div class="phrase-romanize">${item.rom}</div>` : ''}
        </div>
        <button class="play-btn" onclick="event.stopPropagation();speakCond('${escapeSpeech(item.tr)}','${letter}',${i})">‚ñ∂</button>
      </div>`;
    });
    html += `</div></div>`;
  });
  const st = getOrInitSection(currentLang, 'conditions');
  if (!st.quizDone) {
    html += `<button class="start-quiz-btn" onclick="startQuiz('conditions')">üéØ Take Quiz for this Section</button>`;
  } else {
    html += `<div style="background:#d1fae5;border-radius:12px;padding:1rem;text-align:center;margin-top:1rem;color:#166534;font-weight:700;">‚úÖ Quiz completed ‚Äî Score: ${st.quizScore}/10 <button class="btn-primary" style="margin-left:1rem;padding:0.5rem 1rem;font-size:0.85rem;" onclick="startQuiz('conditions')">Retake</button></div>`;
  }
  container.innerHTML = html;
}

function toggleSub(el) {
  el.classList.toggle('open');
  el.nextElementSibling.classList.toggle('open');
}

// ‚îÄ‚îÄ‚îÄ SPEECH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function escapeSpeech(text) { return text.replace(/'/g,"&#39;").replace(/"/g,'&quot;'); }

const LANG_CODES = { mandarin: 'zh-CN', malay: 'ms-MY' };

function speak(text, sectionKey, idx, total) {
  if (currentSpeech) { speechSynthesis.cancel(); currentSpeech = null; }
  const u = new SpeechSynthesisUtterance(text);
  u.lang = LANG_CODES[currentLang] || 'en-US';
  u.rate = 0.85;
  const playBtn = document.getElementById('play-' + idx);
  if (playBtn) { playBtn.classList.add('playing'); playBtn.textContent = '‚ñ†'; }
  u.onend = () => {
    if (playBtn) { playBtn.classList.remove('playing'); playBtn.textContent = '‚ñ∂'; }
    currentSpeech = null;
    markSeen(sectionKey, idx, total);
  };
  u.onerror = () => {
    if (playBtn) { playBtn.classList.remove('playing'); playBtn.textContent = '‚ñ∂'; }
    currentSpeech = null;
  };
  currentSpeech = u;
  speechSynthesis.speak(u);
}

function speakCond(text, letter, idx) {
  if (currentSpeech) { speechSynthesis.cancel(); currentSpeech = null; }
  const u = new SpeechSynthesisUtterance(text);
  u.lang = LANG_CODES[currentLang] || 'en-US';
  u.rate = 0.85;
  const st = getOrInitSection(currentLang, 'conditions');
  st.seen.add(letter + '_' + idx);
  saveProgress();
  updateSectionProgress('conditions');
  updateSidebarChecks();
  speechSynthesis.speak(u);
}

function markSeen(sectionKey, idx, total) {
  const st = getOrInitSection(currentLang, sectionKey);
  st.seen.add(idx);
  saveProgress();
  updateSectionProgress(sectionKey);
  updateSidebarChecks();
}
function markSeenCond(letter, idx) {
  const st = getOrInitSection(currentLang, 'conditions');
  st.seen.add(letter + '_' + idx);
  saveProgress();
  updateSectionProgress('conditions');
  updateSidebarChecks();
}

// ‚îÄ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getSectionItems(lang, section) {
  const d = DATA[lang];
  if (section === 'conditions') {
    const all = [];
    Object.entries(d.conditions).forEach(([l,items]) => items.forEach((_,i) => all.push(l+'_'+i)));
    return all;
  }
  return d[section].map((_,i) => i);
}

function getSectionPct(lang, section) {
  const st = getOrInitSection(lang, section);
  const items = getSectionItems(lang, section);
  if (items.length === 0) return 0;
  let seen = 0;
  items.forEach(k => { if (st.seen.has(k)) seen++; });
  const base = Math.round((seen / items.length) * 80);
  const quizBonus = st.quizDone ? 20 : 0;
  return Math.min(100, base + quizBonus);
}

function updateSectionProgress(section) {
  const pct = getSectionPct(currentLang, section);
  document.getElementById('progress-fill').style.width = pct + '%';
  document.getElementById('progress-pct').textContent = pct + '%';
  document.getElementById('progress-label').textContent = 'Section Progress';
}

function updateSidebarChecks() {
  SECTIONS.forEach(s => {
    const pct = getSectionPct(currentLang, s);
    const el = document.getElementById('check-' + s);
    const nav = document.getElementById('nav-' + s);
    if (pct >= 100) { el.textContent = '‚úÖ'; nav.classList.add('completed'); }
    else if (pct > 0) { el.textContent = '‚ñ∂'; nav.classList.remove('completed'); }
    else { el.textContent = ''; nav.classList.remove('completed'); }
  });
}

function updateOverallProgress() {
  const pcts = SECTIONS.map(s => getSectionPct(currentLang, s));
  const avg = Math.round(pcts.reduce((a,b) => a+b, 0) / pcts.length);
  document.getElementById('overall-bar-fill').style.width = avg + '%';
}

function updateLandingProgress() {
  if (!currentLang) return;
  updateOverallProgress();
}

// ‚îÄ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getAllItemsForQuiz(lang, section) {
  const d = DATA[lang];
  if (section === 'conditions') {
    const all = [];
    Object.values(d.conditions).forEach(items => items.forEach(item => all.push(item)));
    return all;
  }
  return d[section];
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function generateQuiz(lang, section) {
  const items = getAllItemsForQuiz(lang, section);
  const shuffled = shuffle(items);
  const questions = [];
  const pool = shuffled.slice(0, Math.min(30, shuffled.length));

  for (let i = 0; i < 10; i++) {
    const item = pool[i % pool.length];
    // Alternate: audio-first (identify English) or text‚Üípick translation
    const isAudio = i % 3 === 1;
    let wrongPool = pool.filter(p => p !== item);
    const wrongs = shuffle(wrongPool).slice(0, 3);

    if (isAudio) {
      // Play translation, pick the English word
      const options = shuffle([item, ...wrongs]).map(o => o.en);
      questions.push({ type: 'audio', prompt: item.tr, lang: LANG_CODES[lang], answer: item.en, options, item });
    } else {
      // Show English, pick translation
      const options = shuffle([item, ...wrongs]).map(o => o.tr);
      questions.push({ type: 'text', prompt: item.en, answer: item.tr, options, item });
    }
  }
  return questions;
}

function startQuiz(section) {
  quizState = {
    section,
    questions: generateQuiz(currentLang, section),
    current: 0,
    score: 0,
    answered: false
  };
  renderQuiz();
}

function renderQuiz() {
  const { questions, current, score } = quizState;
  const q = questions[current];
  const content = document.getElementById('main-content');

  let html = `<div class="quiz-wrap">
    <div class="quiz-header">
      <h2 style="color:var(--navy);font-size:1.3rem;">Quiz</h2>
      <span class="quiz-question-counter">Question ${current+1} / ${questions.length}</span>
      <span class="quiz-score-display">Score: ${score}</span>
    </div>
    <div class="quiz-card">
      <span class="quiz-type-badge">${q.type === 'audio' ? 'üîä Audio Question' : 'üìù Text Question'}</span>`;

  if (q.type === 'audio') {
    html += `<p class="quiz-question">Listen to the pronunciation and choose the correct English meaning:</p>
    <button class="quiz-audio-btn" onclick="speakQuiz('${escapeSpeech(q.prompt)}')">
      üîä Play pronunciation
    </button>`;
  } else {
    html += `<p class="quiz-question">What is the ${LANG_LABELS[currentLang]} translation of:<br><em>"${q.prompt}"</em></p>`;
  }

  html += `<div class="options-grid">`;
  q.options.forEach((opt, i) => {
    html += `<button class="option-btn" id="opt-${i}" onclick="answerQuiz(${i},'${escapeSpeech(opt)}')">${opt}</button>`;
  });
  html += `</div>
    <div class="quiz-feedback" id="quiz-feedback"></div>
    <button class="quiz-next-btn" id="quiz-next-btn" onclick="nextQuizQuestion()">${current+1 < questions.length ? 'Next Question ‚Üí' : 'See Results'}</button>
  </div></div>`;

  content.innerHTML = html;
  document.getElementById('progress-label').textContent = 'Quiz Progress';
  document.getElementById('progress-fill').style.width = (current / questions.length * 100) + '%';
  document.getElementById('progress-pct').textContent = current + '/' + questions.length;
}

function speakQuiz(text) {
  if (currentSpeech) speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = LANG_CODES[currentLang] || 'en-US';
  u.rate = 0.85;
  speechSynthesis.speak(u);
}

function answerQuiz(idx, chosen) {
  if (quizState.answered) return;
  quizState.answered = true;
  const q = quizState.questions[quizState.current];
  const correct = chosen === q.answer;
  if (correct) quizState.score++;

  document.querySelectorAll('.option-btn').forEach((btn, i) => {
    btn.disabled = true;
    if (btn.textContent === q.answer) btn.classList.add('correct');
    else if (i === idx && !correct) btn.classList.add('wrong');
  });

  const fb = document.getElementById('quiz-feedback');
  fb.className = 'quiz-feedback ' + (correct ? 'correct' : 'wrong');
  fb.textContent = correct ? '‚úÖ Correct!' : `‚ùå Incorrect. The answer was: ${q.answer}`;

  document.getElementById('quiz-next-btn').style.display = 'block';
}

function nextQuizQuestion() {
  quizState.current++;
  quizState.answered = false;
  if (quizState.current >= quizState.questions.length) {
    showQuizResults();
  } else {
    renderQuiz();
  }
}

function showQuizResults() {
  const { score, section } = quizState;
  const st = getOrInitSection(currentLang, section);
  st.quizDone = true;
  st.quizScore = score;
  saveProgress();
  updateSidebarChecks();

  const pct = Math.round(score / 10 * 100);
  let msg = pct >= 80 ? 'üéâ Excellent work!' : pct >= 60 ? 'üëç Good effort!' : 'üí™ Keep practicing!';

  const content = document.getElementById('main-content');
  content.innerHTML = `<div class="quiz-results">
    <div style="font-size:3rem;">üèÜ</div>
    <div class="big-score">${score}<span style="font-size:2rem;color:var(--gray)">/10</span></div>
    <div class="result-msg">${msg}</div>
    <p>You scored ${pct}% on the ${section} quiz.</p>
    <button class="btn-secondary" onclick="startQuiz('${section}')">Retake Quiz</button>
    <button class="btn-primary" onclick="showSection('${section}')">Back to Section</button>
  </div>`;

  document.getElementById('progress-fill').style.width = pct + '%';
  document.getElementById('progress-pct').textContent = pct + '%';
  updateSectionProgress(section);
}

// Init
updateLandingProgress();
</script>
</body>
</html>
